---
# Install Ghostty terminal (System Layer) and deploy configuration

- name: Install Ghostty via AUR
  become: yes
  pacman:
    name: ghostty
    state: present

- name: Ensure Ghostty config directory exists
  file:
    path: "{{ ansible_facts['env']['HOME'] }}/.config/ghostty"
    state: directory
    mode: '0755'

- name: Remove old Ghostty config if exists
  file:
    path: "{{ ansible_facts['env']['HOME'] }}/.config/ghostty/config"
    state: absent

- name: Symlink Ghostty configuration
  file:
    src: "{{ role_path }}/tasks/tools/ghostty/config/config"
    dest: "{{ ansible_facts['env']['HOME'] }}/.config/ghostty/config"
    state: link
    follow: no
    force: yes

- name: Set Ghostty as KDE default terminal
  become: no
  shell: |
    if command -v kwriteconfig6 >/dev/null 2>&1; then
      KWRITE="kwriteconfig6"
    elif command -v kwriteconfig5 >/dev/null 2>&1; then
      KWRITE="kwriteconfig5"
    else
      exit 0
    fi

    $KWRITE --file kdeglobals --group General --key TerminalApplication ghostty
    $KWRITE --file kdeglobals --group General --key TerminalService com.mitchellh.ghostty.desktop

- name: Display Ghostty installation complete
  debug:
    msg: |
      Ghostty installed via pacman (System Layer).
      - Update with: pacman -Syu
      - Config: ~/.config/ghostty/config (symlinked from repo)
