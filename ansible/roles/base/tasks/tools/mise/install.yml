---
# Install mise (modern runtime version manager) - Tool Layer
# Installed via official installer to avoid compilation issues

- name: Install mise via official installer
  args:
    creates: "{{ ansible_facts['env']['HOME'] }}/.local/bin/mise"
  shell: curl https://mise.run | sh

- name: Ensure mise config directory exists
  file:
    path: "{{ ansible_facts['env']['HOME'] }}/.config/mise"
    state: directory
    mode: '0755'

- name: Add mise bin to PATH in fish
  lineinfile:
    path: "{{ ansible_facts['env']['HOME'] }}/.config/fish/config.fish"
    line: "fish_add_path {{ ansible_facts['env']['HOME'] }}/.local/bin"
    create: yes
    state: present

- name: Enable mise in fish shell
  lineinfile:
    path: "{{ ansible_facts['env']['HOME'] }}/.config/fish/config.fish"
    line: "mise activate fish | source"
    state: present

- name: Display mise installation note
  debug:
    msg: |
      Mise installed via official installer (Tool Layer).
      - Update with: mise self-update
      - Use 'mise use <tool>@<version>' to install runtimes
      - Example: mise use node@20, mise use python@3.12
      - Config: ~/.config/mise/config.toml or project-level .mise.toml
